name: Veracode SCA

on:
  workflow_dispatch:

jobs:
  sca:
    name: Run Veracode SCA (Java 17)
    runs-on: ubuntu-24.04
    permissions:
      contents: read

    env:
      SRCCLR_API_TOKEN: ${{ secrets.SRCCLR_API_TOKEN }}
      CACHE_DIR: ${{ runner.temp }}/sca-cache

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Java 17 (Temurin)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Verify Java version
        run: java -version

      - name: Run Veracode SCA
        shell: bash
        run: |
          set -euo pipefail
          mkdir -p "$CACHE_DIR"
          curl -sSL https://sca-downloads.veracode.com/ci.sh | bash -s -- scan --update-advisor --allow-dirty --recursive
